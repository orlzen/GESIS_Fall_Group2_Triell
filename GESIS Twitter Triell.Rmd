---
title: "Twitter communication after Triell"
author: "Melanie Dietz, Julia Lück-Benz, Carina Weinmann, Lorenz Biberstein, Gabor Scheiring"
date: "`r format(Sys.Date(), '%d %b %Y')`"
output: html_document
---

```{r libraries}
library(rtweet)
library(ggplot2)
library(knitr) # for generating tables in markdown
library(janitor) # for creating tables
library(wordcloud) # zur Erstellung von wordclouds
library(DataExplorer) # Für Exploratory Data Analysis
library(ggrepel)
library(kableExtra) # Für schöne Tabellen
library(scales)
library(Cairo) # Zum Export von Grafiken
library(data.table)
library(writexl) # Um Daten im Excel-Format zu exportieren
library(quanteda) # Quantitative Analysis of Textual Data 
# library(quanteda.textmodels) # Functions for scaling and classifying textual data
# library(quanteda.textstats) # Statistics for textual data
# library(quanteda.textplot) # Statistics for textual data 
library(readtext) # companion package of quanteda for loading texts
library(tm) # Für text mining
library(tidytext) # for text mining
library(spacyr) # Für Lemmatisierung
# library(mallet) # For topic modelling
library(readxl) # For importing older Excel-saves
library(topicmodels) # For topic modeling
```


```{r setup, include = TRUE}
# Global setup for all R chunks in this file
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(include = TRUE) # for now all R chunks are included, can be taken out here later
```


# Getting twitter data

Data from twitter is loades using the `rtweet` package. 

```{r twitter_token}
source("twitter_token.R", local = knitr::knit_global())
# load twitter tokens from separate file (not shared on github for privacy reasons)
```

We search for tweets with the query "Triell", do not include retweets and only search for tweets from users with German language.

```{r get_twitter_data}
triell <- search_tweets("Triell", # Search tweets with search phrase "Triell"
                        n = 18000, # get number of tweets
                        include_rts = FALSE, # do not include retweets
                        lang = "de" #, # Only tweets from Twitter users with German language
#                        retryonratelimit = TRUE
                        )
```


```{r save_to_disk}
# Save data as csv
write_as_csv(triell, "data/triell_2021-09-14.csv", prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")
```


# Data cleaning and preparation

```{r cleaning}
triell$text <-  gsub("https\\S*", "", triell$text)
triell$text <-  gsub("@\\S*", "", triell$text) 
triell$text <-  gsub("amp", "", triell$text) 
triell$text <-  gsub("[\r\n]", "", triell$text)
triell$text <-  gsub("[[:punct:]]", "", triell$text) # remoce punctuation
```

```{r generate_wordlist_text}
triell_text <- triell %>%
  select(name, text) %>%
  unnest_tokens(word, text)
# new object, only words and names of twitter accounts
```

# Data analysis

Our aim is to analyse the German twitter sphere after the first and the second Triell to find differences in the tweets (sentiment analysis etc.).




