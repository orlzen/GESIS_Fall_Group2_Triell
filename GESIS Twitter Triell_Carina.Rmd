---
title: "Twitter communication after Triell"
author: "Melanie Dietz, Julia Lück-Benz, Carina Weinmann, Lorenz Biberstein, Gabor Scheiring"
date: "`r format(Sys.Date(), '%d %b %Y')`"
output: html_document
---

```{r libraries}
library(rtweet)
library(ggplot2)
library(knitr) # for generating tables in markdown
library(janitor) # for creating tables
# library(wordcloud) # zur Erstellung von wordclouds
# library(DataExplorer) # Für Exploratory Data Analysis
# library(ggrepel)
# library(kableExtra) # Für schöne Tabellen
# library(scales)
# library(Cairo) # Zum Export von Grafiken
# library(data.table)
# library(writexl) # Um Daten im Excel-Format zu exportieren
# # library(quanteda.textmodels) # Functions for scaling and classifying textual data
# # library(quanteda.textstats) # Statistics for textual data
# # library(quanteda.textplot) # Statistics for textual data 
# library(readtext) # companion package of quanteda for loading texts
library(tm) # Für text mining
library(tidytext) # for text mining
# library(spacyr) # Für Lemmatisierung
# # library(mallet) # For topic modelling
# library(readxl) # For importing older Excel-saves
# library(academictwitteR)
library(data.table)
library(quanteda) # Quantitative Analysis of Textual Data 
library(quanteda.textstats)
library(syuzhet)
library(dplyr) # For topic modeling
library(topicmodels)
library(plotly)
```


```{r setup, include = TRUE}
# Global setup for all R chunks in this file
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(include = TRUE) # for now all R chunks are included, can be taken out here later
```

# Introduction

This is a group work of group #2 in the GESIS fall school "Introduction to Computational Social Sciences with Applications in R". 

The aim of this work is to analyse tweets after the first and the second Triell^[Triell is a portmanteau of "tri", i.e. "three" and "Duell".] in Germany (podium discussions before the "Bundestagswahl").

# Getting twitter data

First, we load data from Twitter. Data from twitter is loaded using the `rtweet` package^[https://cran.r-project.org/web/packages/rtweet/rtweet.pdf] or the `academictwitteR` package^[https://github.com/cjbarrie/academictwitteR, https://cran.r-project.org/web/packages/academictwitteR/index.html]. 

```{r}
#Load tweets via package rtweets
#Save tweets as csv

#ALL DONE 

#triell_b <- search_tweets("#triell AND baerbock", n = 18000, retryonratelimit = TRUE, include_rts = FALSE, lang = "de")
#write_as_csv(triell_b, "data/triell_b_2021-09-15.csv", prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

#triell_s <- search_tweets("#triell AND scholz", n = 18000, retryonratelimit = TRUE, include_rts = FALSE, lang = "de")
#write_as_csv(triell_s, "data/triell_s_2021-09-15.csv", prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

#triell_l <- search_tweets("#triell AND laschet", n = 18000, retryonratelimit = TRUE, include_rts = FALSE, lang = "de")
#write_as_csv(triell_l, "data/triell_l_2021-09-15.csv", prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")
```

# Combining data sets

```{r}
triell_b <- read.csv("data/triell_b_2021-09-15.csv")
triell_s <- read.csv("data/triell_s_2021-09-15.csv")
triell_l <- read.csv("data/triell_l_2021-09-15.csv")

triell_b <- dplyr::mutate(triell_b, candidate = "Baerbock")
triell_l <- dplyr::mutate(triell_l, candidate = "Laschet")
triell_s <- dplyr::mutate(triell_s, candidate = "Scholz")

triell_all <- rbind(triell_b, triell_l, triell_s)
```

#Sentiment analysis

```{r}
#Sentiment analysis of all tweets
method <- "nrc"
lang <- "german"
triell_all$sentiment <- get_sentiment(triell_all$text, method=method, language=lang)
sentiment_details <- get_nrc_sentiment(triell_all$text, language=lang)
triell_all$sentiment[1:10]

#Comparison of candidates
triell_all %>% 
  group_by(candidate) %>% 
  summarise(sent=mean(sentiment), n=n()) %>% 
  arrange(desc(n)) %>% head(n=3) %>% 
  arrange(desc(sent))

#Identifying users with most positive tweets
triell_all %>% 
  group_by(screen_name) %>% 
  summarise(sent=mean(sentiment), n=n()) %>% 
  arrange(desc(n)) %>% head(n=20) %>% 
  arrange(desc(sent))
```

#Keyness

```{r}
triell_corpus <- corpus(triell_all)

triell_dfm  <-  tokens(triell_corpus) %>% dfm() %>% dfm_group(triell_all$candidate)

head(textstat_keyness(triell_dfm, target="Baerbock",
                      measure="chi2",sort=T), n=20)

head(textstat_keyness(triell_dfm, target="Scholz",
                      measure="chi2",sort=T), n=20)

head(textstat_keyness(triell_dfm, target="Laschet",
                      measure="chi2",sort=T), n=20)

#Wordclouds on keyness analyses
library(wordcloud)
library(wordcloud2)
library(RColorBrewer)
library(dplyr)

#Wordclouds on keyness analysis Baerbock
#Package wordcloud
keyness_b <- head(textstat_keyness(triell_dfm, target="Baerbock", measure="chi2",sort=T), n=20)
keyness_b <- keyness_b[-c(1, 2),]#removing "#baerbock" and "baerbock"
wordcloud(keyness_b$feature, keyness_b$chi2, colors="green")

#Package wordcloud2
keyness_b_short <- subset(keyness_b, select=c(feature, chi2))
wordcloud2(keyness_b_short, color = "random-dark")

#Wordclouds on keyness analysis Scholz
#Package wordcloud
keyness_s <- head(textstat_keyness(triell_dfm, target="Scholz", measure="chi2",sort=T), n=20)
keyness_s <- keyness_s[-c(1, 2),]#removing "#scholz" and "scholz"
wordcloud(keyness_s$feature, keyness_s$chi2, colors="red")

#Package wordcloud2
keyness_s_short <- subset(keyness_s, select=c(feature, chi2))
wordcloud2(keyness_s_short, color = "random-dark")

#Wordclouds on keyness analysis Laschet
#Package wordcloud
keyness_l <- head(textstat_keyness(triell_dfm, target="Laschet", measure="chi2",sort=T), n=20)
keyness_l <- keyness_l[-c(1, 2),]#removing "#laschet" and "laschet"
wordcloud(keyness_l$feature, keyness_l$chi2, colors="black")

#Package wordcloud2
keyness_l_short <- subset(keyness_l, select=c(feature, chi2))
wordcloud2(keyness_l_short, color = "random-dark")
```

